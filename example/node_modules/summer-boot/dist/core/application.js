"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var loader_1=require("../util/loader"),parser_decorate_1=require("../util/parser-decorate"),invoke_1=require("./invoke"),config_1=require("../config/config"),bodyParser=require("body-parser"),ip=require("ip"),path=require("path"),express=require("express"),app=express(),workDir=process.cwd();app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0}));var Application=function(){function e(){var e=config_1.Config.getConfig(),r=e.baseDir,a=e.starterHandlerFile,e=e.staticDir;app.use(express.static(path.resolve(workDir,e)));a=path.resolve(workDir,a),a=loader_1.default.loadFile(loader_1.default.getPathAsExtname(a));this.starterHandler=a?new a:null;r=loader_1.default.load(path.resolve(workDir,r));parser_decorate_1.default.parser(r),parser_decorate_1.default.parserAutowrite()}return e.prototype.listen=function(){var e=this;this.starterHandler&&this.starterHandler.before&&this.starterHandler.before(app),app.all("*",invoke_1.invoke);var r=config_1.Config.getConfig().port;app.listen(r,ip.address(),void 0,function(){e.starterHandler&&e.starterHandler.after&&e.starterHandler.after(app)})},e}();exports.default=Application;