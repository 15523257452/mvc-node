"use strict";var __extends=this&&this.__extends||function(){var o=function(e,r){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)};return function(e,r){function t(){this.constructor=e}o(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}}();Object.defineProperty(exports,"__esModule",{value:!0});var worker_1=require("./worker"),logger_1=require("../util/logger"),cluster=require("cluster"),EventEmitter=require("events").EventEmitter,SummerWorker=function(t){function o(e){void 0===e&&(e={});var r=t.call(this)||this;return r.worker=cluster.fork(e),r.type=e.SUMMER_WORKER_TYPE,r.worker.on("exit",r.onExit.bind(r)),r.worker.on("message",r.onMessage.bind(r)),r.worker.on("listening",r.listening.bind(r)),r.worker.on("disconnect",r.disconnect.bind(r)),r.worker.on("error",r.error.bind(r)),r.worker.on("close",r.close.bind(r)),r.worker.on("online",r.online.bind(r)),r.worker.on("uncaughtException",r.uncaughtException.bind(r)),r}return __extends(o,t),o.prototype.send=function(e){this.worker.send(e)},o.prototype.uncaughtException=function(e,r){logger_1.default.error("worker [uncaughtException] pid "+this.worker.process.pid+" type "+this.type),logger_1.default.error(e),logger_1.default.error(r)},o.prototype.close=function(e,r){logger_1.default.warn("worker [closed] pid "+this.worker.process.pid+" type "+this.type+" code "+e+" signal "+r)},o.prototype.online=function(){logger_1.default.info("worker [online] pid "+this.worker.process.pid+" type "+this.type)},o.prototype.disconnect=function(){logger_1.default.warn("worker [disconnect] pid "+this.worker.process.pid+" type "+this.type)},o.prototype.listening=function(e){logger_1.default.info("worker [listening] pid "+this.worker.process.pid+" type "+this.type),this.emit(worker_1.WorkerMessageType.WORKER_LISTEN,e,this)},o.prototype.error=function(){logger_1.default.error("worker [error] pid "+this.worker.process.pid+" type "+this.type)},o.prototype.onExit=function(e,r){logger_1.default.error("worker [exit] pid "+this.worker.process.pid+" type "+this.type+" code "+e+" signal "+r),this.emit(o.WORKER_EXIT,this.worker,e,r)},o.prototype.onMessage=function(e){void 0!==e.type&&this.emit(e.type,e)},o.WORKER_EXIT="worker-exit",o}(EventEmitter);exports.default=SummerWorker;