"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var config_1=require("../config/config"),chalk_1=require("chalk"),date_1=require("./date"),Console=require("console").Console,fs=require("fs"),path=require("path"),log=config_1.Config.getConfig().log,logPath=path.resolve(process.cwd(),log.dir,log.name);fs.existsSync(log.dir)||fs.mkdirSync(log.dir);var LoggerLevel,stdout=fs.createWriteStream(logPath,{flags:"a"}),logger=new Console({stdout:stdout,stderr:stdout});!function(e){e.DEBUG="DEBUG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR"}(LoggerLevel=LoggerLevel||{});var LoggerLevelColor={DEBUG:chalk_1.default.white,INFO:chalk_1.default.white,WARN:chalk_1.default.yellow,ERROR:chalk_1.default.red};function consoleLog(e,r){var o=date_1.default.currentDate()+" ["+r+"] "+e,t=r.toLowerCase(),e=Object.keys(LoggerLevel);console[t](LoggerLevelColor[r](o)),e.indexOf(r)>=e.indexOf(log.level)&&logger[t](o),renameLogfile()}function renameLogfile(){var e=parseSize(log.size);if(!(fs.existsSync(logPath)&&fs.statSync(logPath).size<=e))for(var o=path.parse(logPath),t=date_1.default.format("YYYY-MM-DD"),a=1,r=function(){var e,e=(e=a,path.resolve(o.dir,o.name+"-"+t+"("+e+")"+o.ext));if(!fs.existsSync(e)){var r=fs.createWriteStream(e);return r.on("open",function(){var e=fs.createReadStream(logPath);e.pipe(r),e.on("end",function(){return fs.writeFileSync(logPath,"")})}),"break"}a++};;)if("break"===r())break}function parseSize(e){if("string"!=typeof e)return 1024*e;var r=Number(e.replace(/[a-zA-Z]/g,""));if(e.endsWith("mb"))return 1024*r*1024;if(e.endsWith("kb"))return 1024*r;throw new Error("log size format error")}var Logger={};Object.keys(LoggerLevel).forEach(function(r){return Logger[r.toLowerCase()]=function(e){return consoleLog(e,r)}}),exports.default=Logger;